import 'dart:async';
import 'dart:math';
import '../models/fall_alert.dart';
import 'notification_service.dart';

class MockFallDetectionService {
  MockFallDetectionService._();
  static final MockFallDetectionService _i = MockFallDetectionService._();
  factory MockFallDetectionService() => _i;

  final _rng = Random();
  Timer? _timer;
  final _alerts = StreamController<FallAlert>.broadcast();
  Stream<FallAlert> get alerts$ => _alerts.stream;

  void start() {
    _timer?.cancel();
  //  _timer = Timer.periodic(const Duration(seconds: 30), (_) => _emitRandom());
  }

  void stop() {
    _timer?.cancel();
    _timer = null;
  }

  Future<void> emitNow() => _emitRandom();

  Future<void> _emitRandom() async {
    // Example directory of patients with emergency contacts
    final patients = [
      {
        'id': 'p1',
        'name': 'John Carter',
        'phone': '18002428447',
        'ecName': 'Sarah Carter',
        'ecPhone': '18002428447',
      },
      {
        'id': 'p2',
        'name': 'Amelia Lopez',
        'phone': '18002428447',
        'ecName': 'Luis Lopez',
        'ecPhone': '18002428447',
      },
      {
        'id': 'p3',
        'name': 'Michael Chen',
        'phone': '18002428447',
        'ecName': 'Grace Chen',
        'ecPhone': '18002428447',
      },
    ];

    final picked = patients[_rng.nextInt(patients.length)];
    final isCamera = _rng.nextBool();
    final hasVideo = isCamera && _rng.nextBool();
    final Map<String, dynamic> responseData = {
  "status_code": 200,
  "message": "The request has succeeded.",
  "success": true,
  "data": {
    "alert": {
      "resolved_by": null,
      "skeleton_confidence": 0.19921875,
      "background_url": "https://cdn.pixabay.com/photo/2016/11/18/17/20/living-room-1835923_1280.jpg",
      "skeleton_file": "AwAAAPf+92j+////UgAAAKQAXABVACwABQBWAAAAAA7BAjgBBAVjAxcAywYHDgAAAK9WACkAAahVACwAAp9QAC0AA5tLACkABLFIACIABaFZACsABp1dACkAB7FiACQACH1TADgACQ5TADsAC11bADcADq1WACgAD1NWACgAEL5SACkAKwEADbECOwEJBVADJgB4DAxIAAAArFgAKQABq1UALQACpFAALQADjUsAKQAErUcAIgAFqloALAAGlV4AKQAHq2IAIwAIdFQAOgALXVwANwAOr1YAKAAPQ1gAKAAQtlMAKQDKAQANmgI4ASAFYwMhALcICBUAAACwWAApAAGtVQAtAAKsUAAtAAOaSwAoAASwRgAiAAWvWgAsAAakXgAoAAevYwAjAAhsUwA7AAtlWwA6AA6uVgAoAA92WAAoABC+UwApAJECAA6aAiIBIAUaBAoAxggHFwUAALFYACkAAatVACwAAqtQACwAA55LACgABK9GACMABaZaACwABpVeACkAB6VjACQACHdTADoACRBTAEUAC2tbADgADrJWACgAD1pYACgAELhTACkAKwQADYkCRgElBV0DGQDABwcVAAAAsFgAKQABqVUALQACqVAALQADoksAKAAEuUUAIwAFoloALAAGlF4AKQAHqGMAJAAIVFQAOwALWlwAOgAOr1YAKAAPW1gAKAAQvFMAKQDLBAAOjgJGARQFXQMVAM4HBwwAAACwWAApAAGsVQAtAAKpUAAtAAOnSwAoAAS8RQAjAAWpWgAsAAaXXgApAAeuYgAkAAhqUwA6AAk8UQA7AAtwWwA4AA6vVgAoAA9dWAAoABC7UwApADMFAAmzAhgBnQQ3BAkAvggIJQAAAapVAC0AAqZQAC0AA59LACkABLdFACMACGpTADoACUpRADsACidZAEgAC3FbADgAELpTACkAgQcADokCRgElBV0DEwDRBQUOAAAAsVgAKQABq1UALQACq1AALAADoUsAKAAEtUUAIwAFqVoALAAGol4AKAAHrWMAIwAIZ1MAOgAJTFEAOwALbFsAOgAOtFYAKAAPY1gAKAAQulMAKQBrCAAPiQIcASUFNwQJAJ4HB0cAAACwWAApAAGpVQAsAAKqUAAsAAOjSwAoAAS3RQAjAAWqWgAsAAahXgAoAAewYwAjAAh0UwA6AAlPUQA7AAopWABHAAt5WwA4AA6wVgAoAA9aWAAoABC6UwApADUJAA6JAhUBJQU3BAkAvgcGKQAAALBYACkAAaxVACwAAqpQACwAA6JLACgABLlFACMABapaACwABqJeACkAB65jACMACHtTADoACQxYAEkAC2hbADoADq9WACgAD2RYACgAELpTACkAYQoADokCHAElBTcECACyBwY1AAAAr1gAKQABq1UALQACqFAALQADp0sAKAAEukUAIwAFqFoALAAGoF4AKAAHqGMAIwAIblMAOwAJFFMARwALZlwAOgAOsFYAKAAPbFgAKAAQvFMAKQAfCwAOiQIfASUFKwQRAK4IBy4AAACvWAApAAGrVQAtAAKsUAAtAAOkSwAoAAS4RQAjAAWkWgAsAAahXgApAAetYwAjAAhSUwA7AAkMUQBGAAtfWwA6AA6vVgAoAA9fWAAoABC6UwApAMQLAA2aAjsBIAVQA08AfgkJHQAAAKxYACkAAalVACwAAqlQACwAA5pLACgABLZGACIABaNaACwABpxeACkAB6xjACMACGVTADoAC2NcADgADrFWACgAD2BYACgAELhTACkA4Q0ADpoCEQEgBTIEFgCDDQtLAAAAsVgAKQABrVUALQACqlAALQADoksAKAAEvUYAIgAFq1oALAAGqF4AKAAHsGMAIwAIZFMAOwAJDlMARgALYFsAOgAOsFYAKAAPYlgAKAAQvlMAKQCIDgAOmgIYASAFDQQcAIITEDwAAACxWAApAAGsVQAtAAKlUAAtAAOYSwAoAAS2RgAiAAWmWgAsAAagXgAoAAeuYwAiAAhvUwA6AAkWUgBEAAtuWwA4AA6vVgAoAA9CWAAoABC7UwApAJIPAA2sAjgBGgVjAxIAzgYHDwAAAK1YACkAAa5VAC0AAqVQAC0AA5BMACkABLRHACIABaRaACwABqNeACkAB7NjACMACEtUADsAC1tbADoADrNWACgAD2NYACgAEL5TACkAbBAAD6wCHwEaBSsEEgCdDgs1AAAAtVgAKQABs1UALQACqFAALQADkEwAKQAEtUcAIwAFsFoALAAGrF8AKQAHtmMAIwAIa1MAOgAJTVEAOgAKKFgARgALflsAOAAOtlYAKAAPaVgAKAAQwVMAKQCLEQAPvAIrARUFNwQUAIMODE0AAAC2WAApAAG0VQAtAAKkUAAtAAOVSwAqAAStSAAkAAWsWgAsAAafXwArAAekYwAlAAhmVAA6AAmDUAA7AAo3WABHAAuAWwA4AA6wVgAoAA9rWAAoABC3UwApAPMSAA/YAkcB7QQ3BA0ArwoJLQAAAL1YACkAAbNVAC0AAqpPAC0AA7NKACsABLVJACYABa9aAC0ABq1fAC0AB6RgACgACHRSADoACVlQADsAClFZAEgAC35bADgADq9WACgAD3VZACgAEMJUACgAnRMAD/QCSgHGBCkEDQB1CglnAAAAsVgAKQABsVUALQACpk8ALQADuEoAKwAEsksAJgAFpVoALQAGil4ALQAHi18AKQAIZFMAOgAJTVAAOwAKJVgARwALeFsAOAAOrVYAKAAPdFkAKAAQv1QAKABkFAAP+QJZAbUEIgQAAAAAAAD/AACzWAApAAG1VQAtAAKpUAAtAAO2SgArAASoTQAnAAWjWgAtAAaaXgAtAAeJXAAoAAhjUwA6AAl9UAA7AAorWABHAAt/WwA4AA6rVgAoAA9wWAAoABC4VAAoAK0VAAsLA0cBrwShAycAeRMTNgAAACxVACQAAWtVACoAAkBQACoAA5VLACwABJBPACgABTZcACsABoFeAC8AB41ZACkACCxRAD8ACy5cAD0ADyVWACQAbBYADvQCWwHGBIYDDwDPCAgNAAAAOlUAJQABh1UALAACglAALAADq0oALAAEoE8AKQAFUFoALAAGlV8ALwAHrloAKQAIOVIAPgALNFwAPQAOLVQAJQAPOlYAJQAQJFMAJwARH1gAJgBhFwAP+QKTAbUEOQM/AJkKCRIAAAChWAApAAG1VQAtAAKyUAAtAAOxSgAtAASxTQApAAWeWgAtAAauXgAvAAehXAAqAAh5UgA6AAtzWgA4AAwWXgA7AA6gVgAoAA+BWAAoABC8VAAoABEOWQApAGoYAA30AoMBxgRBAyYAtgoJDgAAALpZACkAAbhVAC0AAqxQAC0AA65KAC4ABK9LACkABaBaAC0ABqpfAC8AB5ReACoACFdTADsAC1hbADsADrJWACgAD3VZACcAEMJUACgA7xgADeICgwHMBEEDNQCcCQoaAAAAsVgAKQABuVUALQACrFAALQADrEkALwAEo0oAKgAFpFoALQAGrF8ALwAHq18AKwAIUVMAOwALWFwAOwAOq1YAKAAPcFkAJwAQvVQAKAC1GQAO8AKLAQUFYAMSAMMHBxkAAACrWAApAAGxVQAtAAKnUAAtAAOlSwAxAARJSwAtAAWvWwAtAAaXXwAxAAdfYAAuAAh+UwA6AAtuXAA4AAwNYwA9AA6pVgAoAA+TWAAoABC5UwAoAHwaAA4AA2MB0QTqAwsAzwcHFgAAALFYACgAAblVAC0AArBPAC0AA6VLADMABLZOADQABaJaAC0ABoNdADAAB6ZgADAACI5SADoACRpUAEQAC4NaADgADqtWACcAD1FYACcAEL5TACgAuhsADgUDgwHvBEEDCQDcBQUOAAAAtVgAKQABulQALQACr08ALQADrUwAMgAEt08ANgAFo1oALQAGm10AMAAHq18AMAAIk1IAOgALhFoANwAMF2IAOwAOrlYAJwAPWlgAJwAQwFMAKACiHAAQDANVAQsFNQQEANkEAxgAAAC0WAAoAAG8VAAtAAKxTwAtAAO3TQAyAAS6UAA2AAWlWQAtAAaeXAAwAAesXwAwAAiiUwA6AAlnVQBBAAppWwBIAAuWWgA3AAwZZAA7AA62VgAnAA9SWAAnABC9UwAoAEgdAA8QA4cBzAQtAw4AywkJEgAAALdYACgAAb9UACwAAq9PACwAA7dMADMABLJQADUABadZACwABppcADAAB6tfADAACIVUADoACQxYADcAC4RaADcADA9gADoADrZWACcAD2FYACcAELhTACgAMR4ADwADhwEABS0DFQC9BgcdAAAArVgAKAABuFUALQACr1AALAADtEwAMwAEulEANAAFpFoALQAGll0AMAAHpGAAMQAIelQAOgAJEVYAOgALcFsAOAAMJmMAOgAOtFYAJwAPiFkAJwAQsFMAKAC2HgAOFwOHAekELQMIANoEBBQAAACyWAAoAAG0VQAsAAKoUAAtAAOkTQAzAASoUwA0AAWYWQAsAAalXAAxAAekYAAxAAh4VAA4AAtwWwA3AAwQYgA6AA6zVgAnAA97WQAnABC5VAAnAH0fAA0zA2MB8ATqAwkAyAYEIQAAALFZACcAAa9VACwAAqVRAC0AA6hPADQABKlVADUABZRZACsABoFdADEAB2RjADEACHRWADoACQ5ZAEQAC2lbADYADq1YACcAELtUACcAmyAADk8DeAHIBDQDCgDMBgYaAAAAtVoAJwABtVUALAACqlEALQADplAANQAEoFYANQAFmFkALAAGn10AMAAHpGAAMQAIaVMANwAJK1UAOAALfFoANgAML2AAOgAOrVgAJgAQu1UAJwBiIQAPdwNVAdsE8QMIAM8HBxgAAACyWgAnAAGuVgAsAAKsUwAsAAOwUwA0AAS1WgAzAAWXWgAsAAaeXQAwAAemYAAxAAhtWAA4AAkbYABEAAuEXAA3AAwqYwA9AA6sWQAmAA8bWgAmABCvVgAnACkiAA6TA3gBswQ0AycAURMTXwAAALZbACcAAalWACwAAqtUAC0AA6ZVADQABJBdADMABZBZACwABkJcADIAB2VeADIACE5UADcACSFWADgAC0RaADcADCxgADoADqtaACYAELdWACYA8CIADbQDdQGpBEcDHwBBDhB+AAAAqFwAJwABnVYALAACrlYALAADm1sAMwAEkmAAMgAFgFkALAAGMFwAMgAITFYAOAAJDmAAOAALQlwAOAAMGGAAOwAOsFsAJgAQs1gAJwC3IwAJwAORAbUE9QIpAD8SEXIAAACYXQAnAAGVWAAsAAKzVgAsAAOgXAAyAASPYgAzAAhZWAA2AAs9XAA2AA6pXAAnABC5WQAnADskAAyqA4cBywQtAx0AcxEQSwAAALReACgAAZRYACwAAsBZACwAA59eADIABKZjADMABWpYACsABg1dADMACCZZADgACTxjADgACx5WADoADq9dACcAELpaACcAaSUAC6oDigHLBBwDPgBtEhMsAAAAsV4AKAABilgALAACwFkALAADnV4AMgAEn2MAMwAFaVgAKwAGD10AMwAIMlgAOAALGlYAOAAOrV0AKAAQsloAJwAwJgALuwONAcYECQNqAEYTESgAAACrXgAoAAGQWAAsAAK8WQAsAAOhXgAyAASsYwAzAAV1WAArAAYSXgAzAAhiWAA3AAsqVgA2AA6sXQAnABC3WgAnAPcmAArMA38BwQRUAxsAqA0OHwAAAKZeACgAAZFYACwAAsJZACwAA55eADIABKBjADMABW1YACsACCRZADwACxxYADoADqldACcAELZaACcA3ycADKoDhwHLBC0DKQBnERFKAAAArV4AKAABjlgALAACvFkALAADn10AMgAEtGIAMwAFcFgAKwAGEF4AMwAIWFgANwAJe2MAOgALJFYANwAOq10AJwAQtFoAJwClKAALmgODAdAEQQNJAEwTFEAAAACZXgAoAAGZWAAsAALEWQAsAAOgXgAzAASkYwAzAAV4VgArAAg3WQA7AAldYwA6AAsrVQA6AA6mXQAnABCwWwAnAH8pAAx3A2MB2wTqAxMAxgcGFwAAAJxeACgAAZpYACwAAsBZACwAA6heADMABLNjADMABX5WACsACEhYADgACW5jADoACkZdAEQACyRTADoADqhdACcAELdbACgAjioADIgDZwHWBNcDEQC0DAoiAAAAkF4AKQABlFgALAACw1kALAADpF4AMgAEqGMAMwAFclYAKwAILFkAOwAJX2MAOgAKGlwAQwALH1QAPAAOn10AKAAQtloAJwBVKwAMiAN2AdYE0AMRAMQICBcAAACSXgApAAGYWAAsAALHWQAsAAOkXgAyAAStYwAzAAV3VgArAAgoWQA6AAliYwA6AAo0XgBDAAsbVAA7AA6hXQAoABC1WwAoABssAAuqA4MBywRBA28AQRISKQAAAKVeACgAAZdYACwAAsRZACwAA6deADIABK1jADMABXZYACsACDtYADsACVpjADoACyVWADgADqldACcAELdbACcA4iwACsQDigF2BBwDagATDRdcAAAAml4AKAABl1gALAACxFkALAADqF4AMgAFfFgAKwAGDV4AMwAIT1gAOAALLFYANwAOpF0AKAAQuVsAJwDKLQALmgOTAdAEOQMzAJIPDRwAAACcXgApAAGVWAAsAALBWQAsAAOmXgAyAASpYwAzAAV7WAArAAg/WAA7AAldYwA6AAslVQA6AA6mXQAoABC9WwAoANIuAAyIA3MB1gTjAw8AyAcGFwAAAKBeACgAAZpYACwAAsBZACwAA6JeADMABKNjADMABX9WACsACDVaADoACXxjADoAClpdAEQACyFUADwADqNdACgAELZbACgAmC8ACnwDkwHKBDkDEgDHCQgSAAAAlV4AKQABmVgALAACwFkALAADpF4AMgAEp2IAMwAFfFYAKwAIP1oAOwALIlMAOwAOn10AKAAQvFsAKABgMAALqgN/AcsEVAM2AIwNDx8AAACXXgAoAAGVWAAsAALBWQAsAAOiXgAyAASiYwAzAAV3WAArAAgvWQA8AAldYwA6AAscVgA6AA6kXQAoABC6WwAnAEgxAAu7A38BxgRUAykAnA8QGAAAAJ9dACgAAZJYACwAAsJZACwAA6FeADIABJ1jADQABXNYACsACDFaADwACT9jADoACyxWADoADqhdACcAELJbACcADzIADIgDdgHWBNADEwC+CgkZAAAAol4AKAABlFgALAACwFkALAADoV4AMwAEoWMANAAFdFgAKwAIPVoAOwAJVGMAOgAKOFwAQwALIVQAOwAOoV0AKAAQtVsAKAC1MgALmgOWAdAEJgMwAHQSEjUAAACbXgAoAAGWWAAsAAK+WQAsAAOhXgAyAASiYwAzAAV4WAArAAhBWQA4AAllYwA6AAsnVQA6AA6fXQAoABC6WwAoAMEzAAyIA3YB1gTQAxIAwQkIGQAAAJxeACkAAZhYACwAAr1ZACwAA51eADMABJhjADQABX1WACsACEJYADoACXdjADoACkhdAEMACydUADoADqBeACgAELtbACgAqjQADZoDYwHQBOoDDQDMBwYWAAAAoF4AKAABmFgALAACwVkALAADoF4AMgAEo2IAMwAFdFgAKwAIP1gAOgAJcGMAOgAKVF4ARAALI1UAOAAMD2IANwAOpV0AJwAQt1sAJwBxNQAMdwNzAdsE4wMABAAAAAD6AACaXgAoAAGbWAAsAAK/WQAsAAOlXgAyAASuYgAzAAV/VgArAAgzWAA4AAmEYwA6AApVXgBEAAsiUwA7AA6iXQAoABC2WwAoAAQ5AAuIA5YB1gQmAzcAaxMTNAAAAJVeACkAAZRYACwAAr5ZACwAA6JeADIABKdjADMABXxYACsACEZZADoACV9jADoACyxUADoADqRdACgAELpbACgABDoADXIDdgHrBNADFwC6CwkXAAAAm14AKQABllkALAACwFkALAADp14AMgAEsWIAMwAFgFgAKwAGDV0AMwAIYlgAOAAJWWQAOgAKJloAQwALMFMAOAAOqV0AKAAQvVsAKADtOgALuwN/AcYEVAMuAI8QEh0AAAChXgAoAAGVWAAsAALAWQAsAAOhXgAyAASjYwAzAAV2WAArAAYMXgAzAAgzWQA8AAsgVgA4AA6tXQAnABC0WwAnAJM7AA2IA3YB1gTQAw8AzQcHEwAAAI5dACkAAZpYACwAArxZACwAA6JeADIABKViADMABYFWACsABgxdADMACEpZADoACWdjADoAChBaAEMACyhUADoADqBdACgAELhbACgAfDwADI4DcwHEBOMDAAAAAAAA/gAAll4AKQABlFgALAACwFkALAADpV4AMgAEnmIAMwAFeVgAKwAIMFkAOwAJeWIAOgAKPV4ARAALIFQAOwAOoF0AKAAQu1sAKABWPQAKjgOHAcQELQMmAHQSEz4AAACWXgApAAGVWAAsAAK/WQAsAAOlXgAyAASlYgAzAAV7WAArAAhNWQA6AAsvVAA4AA6lXQAnABC4WwAnAB0+AA13A2MB2wTqAxQAwwgHGAAAAJteACkAAZpYACwAAsBZACwAA6NeADIABKtiADMABYBWACsABgxaAC0ACFxYADgACXhjADoAChVbAEQACzRTADgADqVdACgAELdbACcAwz4ADJoDZwHQBNcDDQDLBwcXAAAAp14AKAABk1gALAACwFkALAADpF4AMgAEq2MAMwAFeFgAKwAIOVgAOwAJX2MAOgAKE1wAQwALKFUAOAAOqV0AKAAQtlsAJwCKPwANdwNjAdsE6gMTAMoHBhMAAACOXQApAAGaWAAsAALDWQAsAAOnXgAyAASzYgAzAAV+WAArAAYOXgAzAAhoWAA4AAl7YwA6AAo/XABEAAs2UwA4AA6eXQAnABC4WwAoAKVAAAuIA4cB1gQtAx8AkRAPLgAAAKBeACkAAZhYACwAAsFZACwAA6NdADIABKhiADMABXpYACsACFJYADgACRpjADoACy5UADgADqhdACgAELZbACcAZUEADXcDYwHbBOoDEwDJCAcSAAAAlF0AKQABl1gALAACwFkALAADpF4AMgAEtGMAMwAFfFgAKwAGDF0AMwAIYVYANwAJcGMAOgAKPl0ARAALLVMANwAOo10AKAAQtFoAJwAsQgAMdwNnAdsE1wMQANUHBwsAAACPXQAoAAGbWAAsAAK+WQAsAAOmXgAyAASuYgAzAAWBVgArAAhXWAA4AAlqYwA6AAoUWgBDAAsxUwA4AA6iXQAnABC2WwAnAPNCAA2qA28BywT2Aw4AyQYFGgAAAJNeACkAAZtYACwAAr1ZACwAA6VeADIABKNiADMABXpWACsACD1YADsACVhjADoACiJfAEUACy5WADgADA1gADgADqZdACgAELdaACgAu0MAC5oDhwHQBC0DQgA4ERFhAAAAnl0AKAABllgALAACvVkALAADoV4AMgAEqGIAMwAFe1gAKwAISlgAOAAJYmMAOgALMlUAOAAOqV0AJwAQs1oAKACjRAAMiAN6AdYEvQMgAMQHBwkAAACcXQApAAGfWAAsAAK+WQAsAAOhXgAyAASnYgAzAAWEVgArAAhBWAA7AAloYwA6AAoTWgBCAAsrVAA6AA6nXQAoABC1WgAoACdFAA53A2cB2wTXAxIA0wYGCgAAAJxdACgAAZZYACwAArxZACwAA6VeADIABLpjADMABX9WACsABg5eADMACGZWADcACYljADoAClBbAEMACy1TADcADA5iADcADqddACcAELZaACgAgEYAC3wDhwHKBC0DFAC4CwsbAAAAjV0AKAABllgALAACwVkALAADqF4AMgAErGIAMwAFdlgAKwAGDV0AMwAIU1kAOgALMFMAOgAOn10AJwAQtFsAJwBHRwAKuwOTAcYEOQNKAG8SEh8AAACXXgAoAAGXWAAsAALBWQAsAAOlXgAyAASrYwAzAAV7VgArAAgsWgA7AAk7YwA4AA6kXQAoABC0WwAoAA9IAAyaA3YB0ATQAwkA2QYGDgAAAJZdACkAAZtYACwAAsJZACwAA6ZeADIABKViADIABX1WACsACEBYADsACU9jADoACg9aAEMACydVADoADqddACgAELdbACgA2kgAC3cDlgHbBCYDGQCeDwwrAAAAlV4AKAABmFgALAACwFkALAADpF4AMgAErGIAMwAFfVYAKwAIVlgAOAAJfmMAOgALMVMAOAAOn10AKAAQuFsAKAC3SQAMdwNzAdsE4wMAAwAAAAD7AACaXgAoAAGYWAAsAALAWQAsAAOiXgAyAASoYgAzAAV5WAArAAhaWAA4AAmEYwA6AApFXwBEAAsyUwA4AA6nXQAoABC4WwAoAKBKAAyIA3MB1gTjAxsArAwKHwAAAJ1fACkAAZRYACwAAsRZACwAA59eADIABKViADMABXBWACsACDVYADsACXFjADoACjFeAEQACyZUADsADqVeACgAEL1bACgAfUsADYgDegHWBL0DGwDLBwcJAAAAlV4AKQABk1gALAACv1kALAADpF4AMgAEqWIAMwAFdlgAKwAGDF0AMwAIPFgAOgAJY2MAOgAKHFoAQgALKFQAOgAOn10AKAAQuFsAKAAiTAAMmgN2AdAE0AMUALgJCR4AAACYXQApAAGaWAAsAALEWQAsAAOhXgAyAASaYgAzAAV7VgArAAgwWQA8AAlVYwA6AAoxWwBDAAsjVQA7AA6nXQAoABC3WwAoAA1NAAyaA2MB0ATqAw4AzgcGEwAAAKFeACgAAZtYACwAAr1ZACwAA6BeADIABIxiADMABX1WACsACEdYADoACU5jADoACi9eAEQACypVADgADqhdACgAELZbACcA9E0AC5oDkwHQBDkDNQCQDw0cAAAAk14AKQABlVgALAACvlkALAADml4AMgAEgWIAMwAFd1YAKwAIOloAOwAJa2MAOgALJlUAOwAOn10AKAAQvFsAKAA=",
      "time": "2025-10-21T02:16:04.000Z",
      "unix_time": 1761012964,
      "updated_at_unix_time": 1761012965,
      "event_type": 5,
      "serial_number": "238071A4F37D31EE",
      "person_name": "Mark",
      "person_id": 18466,
      "room_name": "Room 1",
      "camera_name": "capstone",
      "room_id": 77676,
      "camera_id": 19401,
      "is_resolved": false,
      "is_false_alert": false,
      "is_true_alert": false,
      "comment": "",
      "status": 1
    },
    "is_call_available": true,
    "camera_to_call": {
      "sip_username": "camera-prod-57087-deea29d2-d62b-4549-aefe-078051316365",
      "serial_number": "238071A4F37D31EE",
      "feature_flag": "110111111111100010101111111111111111110111",
      "is_original_camera": true
    },
    "nearby_available_camera": {
      "id": 19401,
      "sip_username": "camera-prod-57087-deea29d2-d62b-4549-aefe-078051316365",
      "serial_number": "238071A4F37D31EE",
      "feature_flag": "110111111111100010101111111111111111110111",
      "remote_calibration": false,
      "is_original_camera": true
    }
  }
};
    final alert = FallAlert(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      patientId: picked['id']!,
      patientName: picked['name']!,
      detectedAtUtc: DateTime.now().toUtc(),
      source: isCamera ? 'camera' : 'watch',
      hasLiveVideo: hasVideo,
      liveVideoUrl: hasVideo ? Uri.parse('https://example.com/live/${picked['id']}') : null,
      patientPhone: picked['phone'],
      emergencyContactName: picked['ecName'],
      emergencyContactPhone: picked['ecPhone'],
      playbackData: responseData
    );

    _alerts.add(alert);
    await NotificationService().showFallAlert(alert);
  }
}
